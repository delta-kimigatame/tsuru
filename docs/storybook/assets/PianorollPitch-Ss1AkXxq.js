import{j as m}from"./jsx-runtime-D_zvdyIk.js";import{C as w,P as l}from"./PianorollBackground-CeWu-PaL.js";import{u as E}from"./useThemeMode-DBwfopSL.js";import{L as x}from"./Logging-BGLwk1OE.js";import{u as I}from"./cookieStore-BsTWuq-c.js";import{u as _}from"./musicProjectStore-BsvuTYmn.js";import{l as T}from"./array-CrYMH4lO.js";const C=e=>{const{colorTheme:t,verticalZoom:s,horizontalZoom:r}=I(),{notes:c}=_(),o=E();return m.jsx(m.Fragment,{children:m.jsx("svg",{width:e.totalLength*l.NOTES_WIDTH_RATE*r,height:l.TOTAL_HEIGHT*s,style:{pointerEvents:"none",display:"block",position:"absolute",top:0,left:0,zIndex:2},children:c.map((u,n)=>m.jsx(m.Fragment,{children:u.lyric!=="R"&&u.pbs!==void 0&&m.jsx("path",{d:A(u,n,e.notesLeft[n]*l.NOTES_WIDTH_RATE*r,s,r),stroke:w[t][o].pitch,fill:"none"},n)}))})})},d=(e,t,s)=>{const r=l.NOTES_WIDTH_RATE*s,c=6e4/(t*480),o=r/c;return e*o},b=(e,t)=>l.KEY_HEIGHT*(107-e)*t+l.KEY_HEIGHT*t/2,P=(e,t)=>l.KEY_HEIGHT*t*e/10,A=(e,t,s,r,c)=>{if(e.pbs===void 0)return x.warn(`pbsが存在しないノートは処理しないはずなのにピッチ描画処理が呼ばれた。note.index:${t}`,"PianorollPitch"),"";if(e.pbw===void 0)return x.warn(`ポルタメント関連パラメータ不整合。pbsが存在するにも関わらずpbwが存在しない。note.index:${t}`,"PianorollPitch"),"";if(e.pbw.length>=2&&(e.pby===void 0||e.pby.length<e.pbw.length-1))return x.warn(`ポルタメント関連パラメータが不整合。pbwの設定とpbyの設定が合わない。note.index:${t}`,"PianorollPitch"),"";const o=e.pbm??[],u=e.pby??[];for(u.slice(0,e.pbw.length-1),o.slice(0,e.pbw.length);o.length<e.pbw.length;)o.push("");const n=L(e,u,s,r,c),f=`M${n[0].x},${n[0].y}`,$=new Array;return o.forEach((h,p)=>{const y=n[p+1].x-n[p].x,a=n[p+1].y-n[p].y;h===""?$.push(H(n,y,a,p)):h==="s"?$.push(O(n,y,a,p)):h==="r"?$.push(i(n,y,a,p)):h==="j"&&$.push(j(n,y,a,p))}),`${f} ${$.join(" ")}`},L=(e,t,s,r,c)=>{const o=new Array;return o.push({x:s+d(e.pbs.time,e.tempo,c),y:e.prev!==void 0&&e.prev.lyric!=="R"?b(e.prev.notenum,r):b(e.notenum,r)-P(e.pbs.height??0,r)}),t.forEach((u,n)=>{o.push({x:T(o).x+d(e.pbw[n],e.tempo,c),y:b(e.notenum,r)-P(u??0,r)})}),o.push({x:T(o).x+d(T(e.pbw),e.tempo,c),y:b(e.notenum,r)}),o},H=(e,t,s,r)=>{const c=`C ${e[r].x+t/6},${e[r].y+s/8} ${e[r].x+t/3},${e[r].y+s/4} ${e[r].x+t/2},${e[r].y+s/2}`,o=`C ${e[r].x+t/3*2},${e[r].y+s/4*3} ${e[r].x+t/6*5},${e[r].y+s*7/8} ${e[r+1].x},${e[r+1].y}`;return`${c} ${o}`},O=(e,t,s,r)=>`C ${e[r].x+t/3},${e[r].y+s/3} ${e[r].x+t/3*2},${e[r].y+s/3*2} ${e[r+1].x},${e[r+1].y}`,i=(e,t,s,r)=>`C ${e[r].x+t/3},${e[r].y+s/2} ${e[r].x+t/3*2},${e[r].y+s/2*Math.sqrt(3)} ${e[r+1].x},${e[r+1].y}`,j=(e,t,s,r)=>`C ${e[r].x+t/3},${e[r].y+s*(1-Math.sqrt(3)/2)} ${e[r].x+t/3*2},${e[r].y+s/2} ${e[r+1].x},${e[r+1].y}`;C.__docgenInfo={description:"",methods:[],displayName:"PianorollPitch",props:{selectedNotesIndex:{required:!0,tsType:{name:"Array",elements:[{name:"number"}],raw:"Array<number>"},description:""},notesLeft:{required:!0,tsType:{name:"Array",elements:[{name:"number"}],raw:"Array<number>"},description:""},totalLength:{required:!0,tsType:{name:"number"},description:""}}};export{C as P,P as d,d as m,b as n};
