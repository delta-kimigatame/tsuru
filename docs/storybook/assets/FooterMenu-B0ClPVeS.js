const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EnvelopeNormalizeBatchProcess-BSAuSwhk.js","assets/BaseBatchProcess-DuMW4YHa.js","assets/Logging-BGLwk1OE.js","assets/OctaveDownBatchProcess-DqYLDDZ9.js","assets/OctaveUpBatchProcess-BwQV1IFm.js","assets/PreprocessingBatchProcess-b9NOfWtU.js","assets/note-PQ4Q7K1Q.js","assets/ResetEditBatchProcess--WFyr1q-.js","assets/Note-CcnmOUAw.js","assets/interp-BFp6dTGs.js","assets/Notenum-DIq-GRnt.js"])))=>i.map(i=>d[i]);
import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{c as d}from"./createSvgIcon-j8Re0J7b.js";import{R as l}from"./index-iNOV5qWA.js";import{a as W,u as J,E as Q}from"./useVerticalFooterMenu-C4WwAev3.js";import{L as o}from"./Logging-BGLwk1OE.js";import{U as X}from"./Ust-B05cA2Ng.js";import{u as Y}from"./musicProjectStore-BsvuTYmn.js";import{u as ee}from"./snackBarStore-cArT9G3j.js";import{B as te,e as se}from"./BatchProcess-Bt0kuvv8.js";import{_ as h}from"./iframe-BvsFYKEp.js";import{B as oe}from"./BaseBatchProcess-DuMW4YHa.js";import{D as ne,a as ae,C as re,b as ce}from"./Close-BlAjChaJ.js";import{u as w}from"./useTranslation-C2ldOi4s.js";import{I as ie}from"./IconButton-B-lYMn6i.js";import{F as le}from"./FooterBatchProcessMenu-0KVUPwu4.js";import{F as ue}from"./FooterZoomMenu-_WMcfIDB.js";import{u as de}from"./useTheme-CBx8ayXt.js";import{T as he,a as m}from"./Tabs-CPAcXarj.js";import{C as f}from"./CircularProgress-BRQdUMA5.js";const me=d(t.jsx("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"}),"Autorenew"),ge=d(t.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download"),pe=d(t.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 5h-3v5.5c0 1.38-1.12 2.5-2.5 2.5S10 13.88 10 12.5s1.12-2.5 2.5-2.5c.57 0 1.08.19 1.5.51V5h4zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4z"}),"LibraryMusic"),fe=d(t.jsx("path",{d:"M8 5v14l11-7z"}),"PlayArrow"),xe=d(t.jsx("path",{d:"M6 6h12v12H6z"}),"Stop"),be=d([t.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"},"0"),t.jsx("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2z"},"1")],"ZoomIn"),I=e=>{const[n,a]=l.useState(null);return[n,p=>{o.info("メニューを開く",e),a(p.currentTarget)},()=>{o.info("メニューを閉じる",e),a(null)}]},_=Object.assign({"../lib/BatchProcess/EnvelopeNormalizeBatchProcess.ts":()=>h(()=>import("./EnvelopeNormalizeBatchProcess-BSAuSwhk.js"),__vite__mapDeps([0,1,2])),"../lib/BatchProcess/OctaveDownBatchProcess.ts":()=>h(()=>import("./OctaveDownBatchProcess-DqYLDDZ9.js"),__vite__mapDeps([3,1,2])),"../lib/BatchProcess/OctaveUpBatchProcess.ts":()=>h(()=>import("./OctaveUpBatchProcess-BwQV1IFm.js"),__vite__mapDeps([4,1,2])),"../lib/BatchProcess/PreprocessingBatchProcess.ts":()=>h(()=>import("./PreprocessingBatchProcess-b9NOfWtU.js"),__vite__mapDeps([5,6,1,2])),"../lib/BatchProcess/ResetEditBatchProcess.ts":()=>h(()=>import("./ResetEditBatchProcess--WFyr1q-.js"),__vite__mapDeps([7,1,2,8,9,10]))});async function Pe(){const e=[];for(const n in _){const a=await _[n]();for(const g in a){const c=a[g];if(typeof c=="function"&&c.prototype instanceof oe){const p=new c;e.push({title:p.title,cls:c})}}}return e}const C=e=>{const{t:n}=w(),a=()=>{o.info("バッチプロセスダイアログを閉じる","BatchProcessDialog"),e.setDialogOpen(!1),e.setProcessing(!1)};return t.jsx(t.Fragment,{children:t.jsxs(ne,{open:e.dialogOpen&&e.batchprocess!==null,onClose:a,fullScreen:!0,children:[e.batchprocess!==null&&t.jsx(ae,{children:n(e.batchprocess.title)}),t.jsx(ie,{onClick:a,"aria-label":"close",sx:{position:"absolute",right:8,top:8},children:t.jsx(re,{})}),t.jsx(ce,{children:e.batchprocess!==null&&t.jsx(te,{selectedNotesIndex:e.selectedNotesIndex,batchprocess:e.batchprocess,handleClose:a})})]})})};C.__docgenInfo={description:"",methods:[],displayName:"BatchProcessDialog",props:{batchprocess:{required:!0,tsType:{name:"BaseBatchProcess"},description:"実行するバッチプロセスの初期化済みインスタンス"},selectedNotesIndex:{required:!0,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"対象ノート。空配列の場合すべて"},dialogOpen:{required:!0,tsType:{name:"boolean"},description:"ダイアログの表示状態"},setDialogOpen:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<boolean>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<boolean>",elements:[{name:"boolean"}]}]},description:"ダイアログの表示状況を更新するためのコールバック"},setProcessing:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<boolean>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<boolean>",elements:[{name:"boolean"}]}]},description:"バッチ処理の実行状況を更新するためのコールバック"}}};const ye=e=>{const{t:n}=w(),a=l.useRef(null),{setUst:g,setNotes:c,setNote:p,setUstFlags:D,setUstTempo:T,notes:i,vb:x}=Y(),b=ee(),[j,P]=l.useState(!1),[M,F]=l.useState([]),[O,B]=l.useState(!1),[R,A]=l.useState(null),[u,y]=l.useState(!1),[E,N,L]=I("FooterMenu.ZoomMenu"),[z,k,S]=I("FooterMenu.BatchProcessMenu"),V=W(),v=J(),q=de();l.useEffect(()=>{o.debug("コンポーネントマウント","FooterMenu"),Pe().then(r=>{o.debug("バッチプロセスの一覧取得","FooterMenu"),F(r)})},[]);const H=r=>{if(!r.target.files||r.target.files.length===0){o.warn("ustの読込がキャンセルされたか失敗しました","FooterMenu");return}P(!0),o.info(`ustの選択:${r.target.files[0].name}`,"FooterMenu"),$(r.target.files[0])},$=async r=>{try{o.info("ustの読込開始","FooterMenu");const s=new X,G=await r.arrayBuffer();await s.load(G),o.info(`ustの読込完了。ノート数:${s.notes.length},bpm=:${s.tempo},flags:${s.flags}`,"FooterMenu"),g(s),T(s.tempo),D(s.flags),x!==null?i.forEach(K=>K.applyOto(x)):o.warn("vbがロードされていません。テスト以外では必ず事前にロードされるはずなので何かがおかしい","FooterMenu"),c(s.notes),P(!1)}catch(s){o.warn(`ustの読込失敗。${s}`,"FooterMenu"),b.setSeverity("error"),b.setValue(n("editor.footer.ustLoadError")),b.setOpen(!0),P(!1)}},U=()=>{o.debug("click ProjectTab","FooterMenu"),o.info("ustファイルの選択","FooterMenu"),a.current.click()},Z=r=>{const s=new M[r].cls;y(!0),s.ui.length===0?(se(e.selectedNotesIndex,i,c,x,s.process,void 0),y(!1)):(o.info(`バッチ処理ダイアログの起動。bp:${s.title}`,"FooterMenu"),A(s),B(!0)),S()};return t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"file",onChange:H,hidden:!0,ref:a,accept:".ust","data-testid":"file-input"}),t.jsxs(he,{orientation:v?"vertical":"horizontal",variant:"scrollable",scrollButtons:!0,sx:{display:"flex",position:"fixed",bottom:0,right:0,width:v?void 0:"100%",height:v?V.height-Q.HEADER_HEIGHT:void 0,zIndex:20,backgroundColor:q.palette.background.default},value:0,children:[t.jsx(m,{icon:j?t.jsx(f,{}):t.jsx(pe,{}),label:n("editor.footer.project"),onClick:U,sx:{flex:1,p:0},value:0,disabled:j||u||e.synthesisProgress}),t.jsx(m,{icon:t.jsx(be,{}),label:n("editor.footer.zoom"),onClick:N,sx:{flex:1,p:0},value:0,disabled:i.length===0||u}),t.jsx(m,{icon:u?t.jsx(f,{}):t.jsx(me,{}),label:n("editor.footer.batchprocess"),onClick:k,sx:{flex:1,p:0},value:0,disabled:i.length===0||u||e.synthesisProgress}),t.jsx(m,{icon:e.synthesisProgress?t.jsx(f,{}):e.playing?t.jsx(xe,{}):t.jsx(fe,{}),label:e.synthesisProgress?`${e.synthesisCount}/${e.selectedNotesIndex.length!==0?e.selectedNotesIndex.length:i.length}`:e.playing?n("editor.footer.playStop"):n("editor.footer.play"),onClick:()=>{e.playing?e.handlePlayStop():e.handlePlay()},sx:{flex:1,p:0},value:0,disabled:i.length===0||u||e.synthesisProgress}),t.jsx(m,{icon:e.synthesisProgress?t.jsx(f,{}):t.jsx(ge,{}),label:e.synthesisProgress?`${e.synthesisCount}/${e.selectedNotesIndex.length!==0?e.selectedNotesIndex.length:i.length}`:n("editor.footer.wav"),onClick:e.handleDownload,sx:{flex:1,p:0},value:0,disabled:i.length===0||u||e.synthesisProgress})]}),t.jsx(ue,{anchor:E,handleClose:L}),t.jsx(le,{anchor:z,handleClose:S,batchProcesses:M,process:Z}),t.jsx(C,{batchprocess:R,selectedNotesIndex:e.selectedNotesIndex,dialogOpen:O,setDialogOpen:B,setProcessing:y})]})};ye.__docgenInfo={description:`エディタビューの下部に表示するフッターメニュー\r
\r
将来の拡張性を考慮してスクローラブルとし、原則アイコンボタンを用いる`,methods:[],displayName:"FooterMenu",props:{selectedNotesIndex:{required:!0,tsType:{name:"Array",elements:[{name:"number"}],raw:"number[]"},description:"選択されているノートのインデックス 将来的に必須引数にするが開発中のため暫定的にオプショナルとする"},handlePlay:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"再生ボタンを押したときの動作"},handleDownload:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"ダウンロードボタンを押したときの動作"},synthesisProgress:{required:!0,tsType:{name:"boolean"},description:"生成処理状況"},synthesisCount:{required:!0,tsType:{name:"number"},description:"生成処理の進捗状況をいくつめのノートまで進んだか"},playing:{required:!0,tsType:{name:"boolean"},description:"再生中の状況"},handlePlayStop:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:"再生を終了するためのコールバック"}}};export{ye as F};
