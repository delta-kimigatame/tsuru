import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r}from"./index-iNOV5qWA.js";import{D as V,a as x,C as F,b as R}from"./Close-BlAjChaJ.js";import{J as L}from"./jszip.min-CqN8Epyx.js";import{F as j}from"./FileList-C50FAmaX.js";import{L as a}from"./Logging-BGLwk1OE.js";import{V as z}from"./VoiceBank-C9vet1UG.js";import{u as k}from"./musicProjectStore-BsvuTYmn.js";import{u as w}from"./snackBarStore-cArT9G3j.js";import{E as y,a as C}from"./EncodingMapping-C3KwdS0E.js";import{E as O}from"./EncodingSelect-BJHgQa4g.js";import{u as A}from"./useTranslation-C2ldOi4s.js";import{I as T}from"./IconButton-B-lYMn6i.js";import{B as E}from"./Button-DslL7Hsi.js";import{C as v}from"./CircularProgress-BRQdUMA5.js";const P=e=>{const{t:i}=A(),[o,c]=r.useState(!1),[n,p]=r.useState(null),[s,f]=r.useState(y.SHIFT_JIS),d=w(),{setVb:D}=k(),S=async(l,m)=>{const h=new L,B=new TextDecoder(C(m));h.loadAsync(l,{decodeFileName:u=>B.decode(u)}).then(u=>{a.info(`encoding:${m}に基づきzipファイルのロード完了`,"LoadVBDialog"),c(!1),p(u.files)})},g=()=>{a.info("音源読込ダイアログを閉じる","LoadVBDialog"),e.setDialogOpen(!1),e.setProcessing(!1)},b=()=>{a.debug("click","LoadVBDialog"),a.info("zipをvoicebankとしてinitialize","LoadVBDialog");const l=new z(n);c(!0),l.initialize().then(()=>{a.info("zipをvoicebankとしてinitialize完了","LoadVBDialog"),D(l),e.setDialogOpen(!1),e.setProcessing(!1)}).catch(m=>{a.error("zipをvoicebankとしてinitialize失敗","LoadVBDialog"),d.setSeverity("error"),d.setValue(i("loadVBDialog.error")),d.setOpen(!0),e.setDialogOpen(!1),e.setProcessing(!1)})};return r.useEffect(()=>{a.debug("ファイル更新もしくはエンコード変更検知","LoadVBDialog"),e.readFile===null?(a.debug("ファイルはnull、ダイアログを閉じる","LoadVBDialog"),e.setDialogOpen(!1)):(a.info(`encoding:${s}に基づきzipファイルのロード`,"LoadVBDialog"),c(!0),S(e.readFile,s))},[e.readFile,s]),t.jsx(t.Fragment,{children:t.jsxs(V,{open:e.dialogOpen&&e.readFile!==null,onClose:g,fullScreen:!0,children:[t.jsxs(x,{children:[i("loadVBDialog.title")," ",i("loadVBDialog.encodeCheck")]}),t.jsx(T,{onClick:g,"aria-label":"close",sx:{position:"absolute",right:8,top:8},children:t.jsx(F,{})}),t.jsxs(R,{children:[t.jsx(O,{value:s,setValue:f,disabled:o}),t.jsx(E,{fullWidth:!0,variant:"contained",color:"primary",onClick:b,disabled:o&&n!==null,size:"large",sx:{mx:1},children:o?t.jsx(v,{color:"inherit",size:20}):i("loadVBDialog.submit")}),t.jsx(j,{processing:o,files:n?Object.keys(n):[]})]})]})})};P.__docgenInfo={description:"",methods:[],displayName:"LoadVBDialog",props:{readFile:{required:!0,tsType:{name:"union",raw:"File | null",elements:[{name:"File"},{name:"null"}]},description:"読み込んだファイル"},dialogOpen:{required:!0,tsType:{name:"boolean"},description:"ダイアログの表示状態"},setProcessing:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<boolean>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<boolean>",elements:[{name:"boolean"}]}]},description:"音源読込処理の状況を更新するためのコールバック"},setReadFile:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<File | null>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<File | null>",elements:[{name:"union",raw:"File | null",elements:[{name:"File"},{name:"null"}]}]}]},description:"読み込んだファイルを更新するためのコールバック"},setDialogOpen:{required:!0,tsType:{name:"ReactDispatch",raw:"React.Dispatch<React.SetStateAction<boolean>>",elements:[{name:"ReactSetStateAction",raw:"React.SetStateAction<boolean>",elements:[{name:"boolean"}]}]},description:"ダイアログの表示状況を更新するためのコールバック"}}};export{P as L};
