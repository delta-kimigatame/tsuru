<<<<<<<< HEAD:docs/assets/EditorView-C-YaevZE.js
import{j as o}from"./jsx-runtime-D_zvdyIk.js";import{R as s}from"./index-iNOV5qWA.js";import{L as e}from"./Logging-BGLwk1OE.js";import{S as C,r as p}from"./synthesis-C19dj4Rf.js";import{u as M}from"./cookieStore-BsTWuq-c.js";import{u as L}from"./musicProjectStore-BsvuTYmn.js";import{u as O}from"./snackBarStore-cArT9G3j.js";import{F as B}from"./FooterMenu-DUkuKFAI.js";import{P as W}from"./Pianoroll-C2fGLyw5.js";import{u as _}from"./useTranslation-C2ldOi4s.js";const q=()=>{const{t:R}=_(),{vb:n,notes:d,ustFlags:E}=L(),{defaultNote:h}=M(),c=s.useMemo(()=>new C,[]),[u,D]=s.useState([]),[a,g]=s.useState(),[l,f]=s.useState(!1),[U,v]=s.useState(0),[x,m]=s.useState(!1),[S,w]=s.useState(!1),[N,V]=s.useState(0),i=s.useRef(null),y=O();s.useEffect(()=>{e.debug("vbかnotesの更新を検知","EditorView"),e.debug("生成済みwavのクリア","EditorView"),g(void 0)},[n,d]),s.useEffect(()=>{e.debug("vbの更新を検知。全てのキャッシュクリア","EditorView"),p.clear(),b()},[n]),s.useEffect(()=>{e.debug("notesかustFlagsかdefaultNoteの更新検知","EditorView"),b()},[d,E,h]);const b=()=>{n!==null&&d.forEach(t=>{const r=t.getRequestParam(n,E,h);if(r.resamp===void 0)return;const T=p.createKey(r.resamp);p.checkKey(t.index,T)||(e.debug(`キャッシュ生成のために、既存のタスクのキャンセル。index:${t.index}`,"EditorView"),c.clearTask(t.index),e.debug(`キャッシュ生成開始。index:${t.index}`,"EditorView"),c.resamp(r,n,t.index).catch(j=>{e.error(`キャッシュ生成の失敗。input:${JSON.stringify(r.resamp)},error:${j.message}
========
import{j as o}from"./jsx-runtime-D_zvdyIk.js";import{R as s}from"./index-iNOV5qWA.js";import{L as e}from"./Logging-BGLwk1OE.js";import{S as C,r as p}from"./synthesis-ByE0JV2T.js";import{u as M}from"./cookieStore-BsTWuq-c.js";import{u as L}from"./musicProjectStore-BsvuTYmn.js";import{u as O}from"./snackBarStore-cArT9G3j.js";import{F as B}from"./FooterMenu-DdbsnZ2K.js";import{P as W}from"./Pianoroll-C7IwiGVC.js";import{u as _}from"./useTranslation-C2ldOi4s.js";const q=()=>{const{t:R}=_(),{vb:n,notes:d,ustFlags:E}=L(),{defaultNote:h}=M(),c=s.useMemo(()=>new C,[]),[u,D]=s.useState([]),[a,g]=s.useState(),[l,f]=s.useState(!1),[U,v]=s.useState(0),[x,m]=s.useState(!1),[S,w]=s.useState(!1),[N,V]=s.useState(0),i=s.useRef(null),y=O();s.useEffect(()=>{e.debug("vbかnotesの更新を検知","EditorView"),e.debug("生成済みwavのクリア","EditorView"),g(void 0)},[n,d]),s.useEffect(()=>{e.debug("vbの更新を検知。全てのキャッシュクリア","EditorView"),p.clear(),b()},[n]),s.useEffect(()=>{e.debug("notesかustFlagsかdefaultNoteの更新検知","EditorView"),b()},[d,E,h]);const b=()=>{n!==null&&d.forEach(t=>{const r=t.getRequestParam(n,E,h);if(r.resamp===void 0)return;const T=p.createKey(r.resamp);p.checkKey(t.index,T)||(e.debug(`キャッシュ生成のために、既存のタスクのキャンセル。index:${t.index}`,"EditorView"),c.clearTask(t.index),e.debug(`キャッシュ生成開始。index:${t.index}`,"EditorView"),c.resamp(r,n,t.index).catch(j=>{e.error(`キャッシュ生成の失敗。input:${JSON.stringify(r.resamp)},error:${j.message}
>>>>>>>> 53ee6d60326375886e43db46abdc56c632fecc81:docs/assets/EditorView-QHSXw1ZM.js
${j.stack}}`,"EditorView")}))})},k=async()=>{e.info("wavファイル生成","EditorView"),f(!0),e.info("wavファイル生成完了","EditorView");try{v(0);const t=await c.synthesis(u,v),r=URL.createObjectURL(new File([t],"temp.wav",{type:"audio/wav"}));return g(r),r}catch(t){e.error(`合成処理の失敗。${t.message}
${t.stack}`,"EditorView"),y.setSeverity("error"),y.setValue(R("editor.synthesisError")),y.setOpen(!0);return}},F=async()=>{if(l){e.warn("handleDownload UI上クリックできないはず。何かがおかしい","EditorView");return}m(!1);const t=a??await k();if(f(!1),t!==void 0){const r=document.createElement("a");r.href=t,r.download="output.wav",r.click()}},I=async()=>{if(l){e.warn("handlePlay UI上クリックできないはず。何かがおかしい","EditorView");return}a!==void 0?(e.info("再生開始","EditorView"),w(!0),i.current.play()):(m(!0),await k(),f(!1))},P=()=>{e.debug("再生終了","EditorView"),w(!1),i.current.pause(),i.current.currentTime=0,V(0)},$=()=>{V(i.current.currentTime*1e3)};return s.useEffect(()=>{e.debug("wavUrlかplayReadyの更新を検知","EditorView"),a!==void 0&&x&&(e.info("再生開始","EditorView"),m(!1),w(!0),i.current.play())},[a,x]),o.jsxs(o.Fragment,{children:[o.jsx(W,{playing:S,playingMs:N,selectedNotesIndex:u}),o.jsx("br",{}),o.jsx("br",{}),o.jsx(B,{selectedNotesIndex:u,handlePlay:I,handleDownload:F,synthesisCount:U,synthesisProgress:l,playing:S,handlePlayStop:P}),a!==void 0&&o.jsx(o.Fragment,{children:o.jsx("audio",{src:a,ref:i,"data-testid":"audio",onEnded:P,onTimeUpdate:$})})]})};q.__docgenInfo={description:"",methods:[],displayName:"EditorView"};export{q as E};
