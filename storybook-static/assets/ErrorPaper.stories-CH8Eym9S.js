import{j as n}from"./jsx-runtime-D_zvdyIk.js";import{w as P,u as y}from"./index-CYFwst5-.js";import{r as p,R as L}from"./index-iNOV5qWA.js";import{g as T,T as g}from"./theme-6pAN8qG3.js";import{i as F}from"./configs-Bv5Ugt3f.js";import{L as d}from"./Logging-BGLwk1OE.js";import{B as O}from"./BasePaper-C7D7U7EW.js";import{F as A}from"./Footer-CkMVKfnr.js";import{L as N}from"./LogPaper-Cl_LGuMG.js";import{u as K}from"./useThemeMode-DBwfopSL.js";import{u as U}from"./useTranslation-C2ldOi4s.js";import{c as v}from"./createTheme-B5w4ml5n.js";import{B as W}from"./Box-D69FHGj3.js";import{T as M}from"./Typography--QOf8yBx.js";import{B as C}from"./Button-DslL7Hsi.js";import"./___vite-browser-external_commonjs-proxy-Daub02KT.js";import"./index-DrFu-skq.js";import"./resolveProps-BxfXLv92.js";import"./index-BOiXDGkM.js";import"./useThemeWithoutDefault-CG-nTen1.js";import"./DefaultPropsProvider-C7n-yi0g.js";import"./generateUtilityClasses-DXwt_ASJ.js";import"./useEnhancedEffect-DCkc7bGx.js";import"./GlobalStyles-cbKtrZEy.js";import"./Paper-Me1pdxeg.js";import"./useTheme-CBx8ayXt.js";import"./useTheme-BMUBEho4.js";import"./Divider-3fxWqrZQ.js";import"./dividerClasses-DUoTRvux.js";import"./index-w39uwJq3.js";import"./getThemeProps-Cyw7R1y9.js";import"./FooterDisclaimer-CBMN6i0X.js";import"./FooterLinks-D5DN8Sf-.js";import"./siteConfig-CRkTc4Y1.js";import"./Link-BecSeJQK.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./isFocusVisible-B8k4qzLc.js";import"./FooterShare-BLozZ4Jb.js";import"./XButton-DCBlhytU.js";import"./createSvgIcon-j8Re0J7b.js";import"./cookieStore-BsTWuq-c.js";import"./note-PQ4Q7K1Q.js";import"./react-D0diZGQB.js";import"./createBox-BQknTud0.js";import"./extendSxProp-C28V3_VZ.js";import"./index-BY9WgCjw.js";import"./useId-CEkcLX0P.js";import"./ButtonBase-WT7DZmCb.js";import"./TransitionGroupContext-BoJwzo5i.js";import"./useForkRef-Dv2UJ9DH.js";import"./CircularProgress-BRQdUMA5.js";const z=p.createContext(null),f={didCatch:!1,error:null};class R extends p.Component{constructor(r){super(r),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=f}static getDerivedStateFromError(r){return{didCatch:!0,error:r}}resetErrorBoundary(){const{error:r}=this.state;if(r!==null){for(var t,e,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];(t=(e=this.props).onReset)===null||t===void 0||t.call(e,{args:i,reason:"imperative-api"}),this.setState(f)}}componentDidCatch(r,t){var e,a;(e=(a=this.props).onError)===null||e===void 0||e.call(a,r,t)}componentDidUpdate(r,t){const{didCatch:e}=this.state,{resetKeys:a}=this.props;if(e&&t.error!==null&&G(r.resetKeys,a)){var i,s;(i=(s=this.props).onReset)===null||i===void 0||i.call(s,{next:a,prev:r.resetKeys,reason:"keys"}),this.setState(f)}}render(){const{children:r,fallbackRender:t,FallbackComponent:e,fallback:a}=this.props,{didCatch:i,error:s}=this.state;let m=r;if(i){const u={error:s,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")m=t(u);else if(e)m=p.createElement(e,u);else if(a!==void 0)m=a;else throw s}return p.createElement(z.Provider,{value:{didCatch:i,error:s,resetErrorBoundary:this.resetErrorBoundary}},m)}}function G(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return o.length!==r.length||o.some((t,e)=>!Object.is(t,r[e]))}const h=({error:o,resetErrorBoundary:r})=>{const{t}=U(),e=K(),a=p.useMemo(()=>v(T(e)),[e]),i=()=>{const s=d.datas.join(`\r
`)+o.message+`\r
`+o.stack+`\r
`;console.log(s);const m=new File([s],`log_${new Date().toJSON()}.txt`,{type:"text/plane;charset=utf-8"}),u=URL.createObjectURL(m),E=document.createElement("a");E.href=u,E.download=m.name,E.click()};return n.jsxs(g,{theme:a,children:[n.jsx(O,{title:t("error.title"),children:n.jsxs(W,{sx:{m:1,p:1},children:[n.jsx(M,{variant:"body2",children:t("error.message")}),n.jsx(C,{fullWidth:!0,variant:"contained",onClick:i,size:"large",sx:{mx:1},color:"error",children:t("error.download")})]})}),n.jsx(N,{}),n.jsx(A,{})]})};h.__docgenInfo={description:`エラー時に表示される画面。\r
操作ログにエラーメッセージを付与したものをテキスト形式でダウンロードすることができる。`,methods:[],displayName:"ErrorPaper"};F.changeLanguage("ja");const S=v(T("light")),Gr={title:"80_ログ/エラー画面",component:h,argTypes:{}},D=()=>{const[o,r]=L.useState(!1);if(o){const t=new Error("テストエラー");throw t.stack=`Error: テストエラー
    at ErrorTrigger (test file)`,t}return n.jsx(C,{onClick:()=>r(!0),children:"エラー発生"})},I=()=>{const o=new Error("テストエラー");return o.stack=`Error: テストエラー
    at TestComponent (test file)`,n.jsx(R,{fallbackRender:({error:r,resetErrorBoundary:t})=>n.jsx(h,{error:r,resetErrorBoundary:t}),children:n.jsx(D,{})})},l=I.bind({});l.args={};l.decorators=[o=>n.jsx(g,{theme:S,children:n.jsx(o,{})})];l.storyName="エラーが生じると自動で表示される";const J=()=>{const o=new Error("テストエラー");return o.stack=`Error: テストエラー
    at TestComponent (test file)`,n.jsx(R,{fallbackRender:({error:r,resetErrorBoundary:t})=>n.jsx(h,{error:r,resetErrorBoundary:t}),children:n.jsx(D,{})})},c=J.bind({});c.args={};c.decorators=[o=>(d.clear(),d.debug("ログテスト","storybook"),d.info("ログテスト","storybook"),d.warn("ログテスト","storybook"),d.error("ログテスト","storybook"),n.jsx(g,{theme:S,children:n.jsx(o,{})}))];c.play=async({canvasElement:o})=>{const r=P(o),t=await r.getByRole("button",{name:/エラー発生/i});await y.click(t);const e=await r.findByRole("button",{name:/ログをダウンロード/i});await y.click(e)};c.storyName="ボタンをクリックしてログをダウンロード";var x,B,w;l.parameters={...l.parameters,docs:{...(x=l.parameters)==null?void 0:x.docs,source:{originalSource:`() => {
  // シンプルなエラーオブジェクトを作成
  const testError = new Error("テストエラー");
  testError.stack = "Error: テストエラー\\n    at TestComponent (test file)";
  return <ErrorBoundary fallbackRender={({
    error,
    resetErrorBoundary
  }) => <ErrorPaper error={error} resetErrorBoundary={resetErrorBoundary} />}>\r
      <ErrorTrigger />\r
    </ErrorBoundary>;
}`,...(w=(B=l.parameters)==null?void 0:B.docs)==null?void 0:w.source}}};var j,k,b;c.parameters={...c.parameters,docs:{...(j=c.parameters)==null?void 0:j.docs,source:{originalSource:`() => {
  const testError = new Error("テストエラー");
  testError.stack = "Error: テストエラー\\n    at TestComponent (test file)";
  return <ErrorBoundary fallbackRender={({
    error,
    resetErrorBoundary
  }) => <ErrorPaper error={error} resetErrorBoundary={resetErrorBoundary} />}>\r
      <ErrorTrigger />\r
    </ErrorBoundary>;
}`,...(b=(k=c.parameters)==null?void 0:k.docs)==null?void 0:b.source}}};const Ir=["WithError","DownloadAction"];export{c as DownloadAction,l as WithError,Ir as __namedExportsOrder,Gr as default};
